{% extends "main/base.html" %}

{% block title %}Exporter les Données{% endblock %}

{% block content %}
    <h2>Exporter les Données</h2>
    <form method="post">
        {% csrf_token %}
        <button type="button" id="toggle-all" class="btn btn-secondary mb-3">Cocher/Décocher Tout</button>
        <div class="category">
            <label class="category-header">
                <input type="checkbox" id="toggle-etudiants"> Étudiants
            </label>
            <div id="etudiants" class="category-content" style="display: none;">
                <label><input type="checkbox" id="toggle-all-etudiants"> Tout cocher/décocher</label>
                {{ form.etudiants }}
            </div>
        </div>
        <div class="category">
            <label class="category-header">
                <input type="checkbox" id="toggle-ues"> Unités d'enseignement (UE)
            </label>
            <div id="ues" class="category-content" style="display: none;">
                <label><input type="checkbox" id="toggle-all-ues"> Tout cocher/décocher</label>
                {{ form.ues }}
            </div>
        </div>
        <div class="category">
            <label class="category-header">
                <input type="checkbox" id="toggle-ressources"> Ressources
            </label>
            <div id="ressources" class="category-content" style="display: none;">
                <label><input type="checkbox" id="toggle-all-ressources"> Tout cocher/décocher</label>
                {{ form.ressources }}
            </div>
        </div>
        <div class="category">
            <label class="category-header">
                <input type="checkbox" id="toggle-enseignants"> Enseignants
            </label>
            <div id="enseignants" class="category-content" style="display: none;">
                <label><input type="checkbox" id="toggle-all-enseignants"> Tout cocher/décocher</label>
                {{ form.enseignants }}
            </div>
        </div>
        <div class="category">
            <label class="category-header">
                <input type="checkbox" id="toggle-examens"> Examens
            </label>
            <div id="examens" class="category-content" style="display: none;">
                <label><input type="checkbox" id="toggle-all-examens"> Tout cocher/décocher</label>
                {{ form.examens }}
            </div>
        </div>
        <div class="category">
            <label class="category-header">
                <input type="checkbox" id="toggle-notes"> Notes
            </label>
            <div id="notes" class="category-content" style="display: none;">
                <label><input type="checkbox" id="toggle-all-notes"> Tout cocher/décocher</label>
                {{ form.notes }}
            </div>
        </div>
        <button type="submit" class="btn btn-primary">Exporter</button>
    </form>

    <script>
        document.getElementById('toggle-all').addEventListener('click', function() {
            const checkboxes = document.querySelectorAll('input[type="checkbox"]');
            const allChecked = Array.from(checkboxes).every(checkbox => checkbox.checked);
            checkboxes.forEach(checkbox => {
                checkbox.checked = !allChecked;
                if (checkbox.id.startsWith('toggle-')) {
                    const contentId = checkbox.id.replace('toggle-', '');
                    document.getElementById(contentId).style.display = checkbox.checked ? 'block' : 'none';
                }
            });
        });

        document.getElementById('toggle-etudiants').addEventListener('change', function() {
            document.getElementById('etudiants').style.display = this.checked ? 'block' : 'none';
        });
        document.getElementById('toggle-ues').addEventListener('change', function() {
            document.getElementById('ues').style.display = this.checked ? 'block' : 'none';
        });
        document.getElementById('toggle-ressources').addEventListener('change', function() {
            document.getElementById('ressources').style.display = this.checked ? 'block' : 'none';
        });
        document.getElementById('toggle-enseignants').addEventListener('change', function() {
            document.getElementById('enseignants').style.display = this.checked ? 'block' : 'none';
        });
        document.getElementById('toggle-examens').addEventListener('change', function() {
            document.getElementById('examens').style.display = this.checked ? 'block' : 'none';
        });
        document.getElementById('toggle-notes').addEventListener('change', function() {
            document.getElementById('notes').style.display = this.checked ? 'block' : 'none';
        });

        document.getElementById('toggle-all-etudiants').addEventListener('change', function() {
            const checkboxes = document.querySelectorAll('#etudiants input[type="checkbox"]');
            checkboxes.forEach(checkbox => checkbox.checked = this.checked);
        });

        document.getElementById('toggle-all-ues').addEventListener('change', function() {
            const checkboxes = document.querySelectorAll('#ues input[type="checkbox"]');
            checkboxes.forEach(checkbox => checkbox.checked = this.checked);
        });

        document.getElementById('toggle-all-ressources').addEventListener('change', function() {
            const checkboxes = document.querySelectorAll('#ressources input[type="checkbox"]');
            checkboxes.forEach(checkbox => checkbox.checked = this.checked);
        });

        document.getElementById('toggle-all-enseignants').addEventListener('change', function() {
            const checkboxes = document.querySelectorAll('#enseignants input[type="checkbox"]');
            checkboxes.forEach(checkbox => checkbox.checked = this.checked);
        });

        document.getElementById('toggle-all-examens').addEventListener('change', function() {
            const checkboxes = document.querySelectorAll('#examens input[type="checkbox"]');
            checkboxes.forEach(checkbox => checkbox.checked = this.checked);
        });

        document.getElementById('toggle-all-notes').addEventListener('change', function() {
            const checkboxes = document.querySelectorAll('#notes input[type="checkbox"]');
            checkboxes.forEach(checkbox => checkbox.checked = this.checked);
        });
    </script>

    <style>
        .category {
            margin-bottom: 20px;
        }

        .category-header {
            font-weight: bold;
            font-size: 18px;
        }

        .category-content {
            border: 1px solid #ddd;
            padding: 10px;
            margin-top: 10px;
            background-color: #f9f9f9;
        }

        .category-content label {
            display: block;
            margin-bottom: 5px;
        }
    </style>
{% endblock %}
